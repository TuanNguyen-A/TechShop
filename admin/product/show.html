<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin</title>

    <script src="../../public/admin/js/config.js"></script>
    <link rel="stylesheet" href="../../public/admin/css/show-product.css">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF"
        crossorigin="anonymous"></script>
</head>

<body>
    <div class="container-fluid d-flex">
        <iframe src="../layout/sidebar.html" frameborder=""></iframe>
        <div class="panel panel-primary">
            <div class="panel-heading">
                <div class="text-center">Product List</div>
            </div>
            <div class="panel-body">
                <a href="#" class="text-center" onclick="logout()">(Logout)</a>
                <form action="">
                    <div class="form-group">
                        <input id="search" type="text" name="search" placeholder="Search Email"
                            style="width: 100%; margin: 5px;">
                    </div>
                </form>

                <table class="table table-bordered table-hover">
                    <thead>
                        <tr>
                            <th width=60px>STT</th>
                            <th>Thumbnail</th>
                            <th>Title</th>
                            <th>Category</th>
                            <th>Quantity</th>
                            <th>Price</th>
                            <th>Discount</th>
                            <th width=60px></th>
                            <th width=60px></th>
                        </tr>
                    </thead>
                    <tbody id="productList">


                    </tbody>

                </table>
                <a href="input.html"><button class="btn btn-success">Add</button></a>
            </div>
        </div>
    </div>

    <script>
        $(function () {
            var search = '';

            listProduct();
            $('#search').on("keyup", function (e) {
                search = $('#search').val();
                listProduct();
            })

            function listProduct() {
                $('#productList').html('');
                $.post(BASE_URL + API_PRODUCT, {
                    'action': LIST,
                    'search': search
                }, function (data) {
                    var obj = JSON.parse(data);
                    if (obj.status == 1) {
                        productList = obj.productList;
                        for (i = 0; i < productList.length; i++) {
                            item = productList[i];
                            categoryList = '';

                            //get category_product
                            if (obj.product_category[item['id']]) {
                                list = obj.product_category[item['id']]
                                for (var i = 0; i < list.length; i++) {
                                    categoryList += '<li class="category-item">' + list[i]['name'] + '</li>';
                                }
                            }

                            $('#productList').append(`
                                    <tr>
                                        <td>${i + 1}</td>
                                        <td><img src="${item['thumbnail']}" class="thumbnail" alt=""></td>
                                        <td>${item['title']}</td>
                                        <td><ul class="category-list">${categoryList}</ul></td>
                                        <td>${item['quantity']}</td>
                                        <td>${item['price']}</td>
                                        <td>${item['discount']}%</td>
                                        <td ><a href="input.html?id=${item['id']}"><button class="btn btn-warning">edit</button></a></td>
                                        <td ><button class="btn btn-danger" onclick="deleteProduct(${item['id']})">delete</button></td>
                                    </tr>
                                    `);
                        }
                    } else {
                        alert(obj.msg);
                        window.open('../authen/login.html', '_self');
                    }
                });

            }



        })

        function deleteProduct(id) {
            var option = confirm("Bạn có chắc chắn muốn xóa danh mục này");
            if (!option) {
                return;
            }
            console.log(id)
            $.post(BASE_URL + API_PRODUCT, {
                'action': DELETE,
                'id': id
            }, function (data) {
                console.log(data);
                var obj = JSON.parse(data);
                if (obj.status == 1) {
                    console.log(obj.msg);
                    location.reload();
                } else {
                    console.log(obj.msg);
                }
            });
        }
        function logout() {
            $.post(BASE_URL + API_ADMIN_AUTHEN, {
                'action': LOGOUT
            }, function (data) {
                window.open('login.html', '_self');
            });
        }
    </script>
</body>

</html>