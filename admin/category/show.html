<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin</title>
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="../../public/admin/js/config.js"></script>

    <link rel="stylesheet" href="../../public/admin/css/show-category.css">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-fQybjgWLrvvRgtW6bFlB7jaZrFsaBXjsOMm/tB9LTS58ONXgqbR9W8oWht/amnpF"
        crossorigin="anonymous"></script>
</head>

<body>

    <div class="container-fluid d-flex">
        <iframe src="../layout/sidebar.html" frameborder=""></iframe>
        <div class="panel panel-primary">
            <div class="panel-heading">
                <div class="text-center">Category List</div>
            </div>
            <div class="panel-body">

                <a href="#" class="text-center" onclick="logout()">(Logout)</a>
                <form action="">
                    <div class="form-group">
                        <input id="search" type="text" name="search" placeholder="Search Email"
                            style="width: 100%; margin: 5px;">
                    </div>
                </form>
                <table class="table table-bordered table-hover">
                    <thead>
                        <tr>
                            <th width=60px>STT</th>
                            <th>Name</th>
                            <th width=60px></th>
                            <th width=60px></th>
                        </tr>
                    </thead>
                    <tbody id="categoryList">


                    </tbody>

                </table>
                <form action="">
                    <div class="form-group">
                        <input id="name" type="text" name="name">
                        <button type="submit" id="btn-add" class="btn btn-success">Add</button>
                    </div>
                </form>

            </div>
        </div>
    </div>


    <script>
        $(function () {
            var search = '';

            listCategory();
            $('#search').on("keyup", function (e) {
                search = $('#search').val();
                listCategory();
            })

            function listCategory() {
                $('#categoryList').html('');
                $.post(BASE_URL + API_CATEGORY, {
                    'action': LIST,
                    'search': search
                }, function (data) {
                    var obj = JSON.parse(data);
                    if (obj.status == 1) {
                        categoryList = obj.categoryList;
                        for (i = 0; i < categoryList.length; i++) {
                            item = categoryList[i];

                            $('#categoryList').append(`
                                    <tr>
                                        <td>${i + 1}</td>
                                        <td><input class="name" type="text" value="${item['name']}" id="${item['id']}"></td>
                                        <td ><button class="btn btn-warning" onclick="updateCategory(${item['id']})">edit</button></td>
                                        <td ><button class="btn btn-danger" onclick="deleteCategory(${item['id']})">delete</button></td>
                                    </tr>
                                    `);
                        }
                    } else {
                        window.open('../authen/login.html', '_self');
                    }
                });

            }

            $('form').submit(function () {
                var name = $("[name=name]").val();
                $.post(BASE_URL + API_CATEGORY, {
                    'action': ADD,
                    'name': name
                }, function (data) {
                    var obj = JSON.parse(data);
                    if (obj.status == 1) {
                        console.log(obj.msg);
                        location.reload();
                    } else {
                        console.log(obj.msg);
                    }
                });
            })

        })

        function updateCategory(id) {
            console.log(id)

            var name = $('#' + id).val();
            console.log(name)
            $.post(BASE_URL + API_CATEGORY, {
                'action': UPDATE,
                'id': id,
                'name': name
            }, function (data) {
                console.log(data);
                var obj = JSON.parse(data);

                if (obj.status == 1) {
                    console.log(obj.msg);
                    location.reload();
                } else {
                    console.log(obj.msg);
                }
            });
        }
        function deleteCategory(id) {
            var option = confirm("Bạn có chắc chắn muốn xóa danh mục này");
            if (!option) {
                return;
            }
            console.log(id)
            $.post(BASE_URL + API_CATEGORY, {
                'action': DELETE,
                'id': id
            }, function (data) {
                console.log(data);
                var obj = JSON.parse(data);
                if (obj.status == 1) {
                    console.log(obj.msg);
                    location.reload();
                } else {
                    console.log(obj.msg);
                }
            });
        }
        function logout() {
            $.post(BASE_URL + API_ADMIN_AUTHEN, {
                'action': LOGOUT
            }, function (data) {
                window.open('login.html', '_self');
            });
        }
    </script>
</body>

</html>